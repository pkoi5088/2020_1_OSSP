# 2020-1-OSSP1-Anyway-8
### 팀원
2018112086 한영빈  
2018112082 하경한  
2018112049 이정석  

### 주제
짧은 시간의 GIF(클립) 생성 프로그램

### 개발 언어
C# - GUI 및 GIF생성  
Python - 동영상 다운로드

### 사용 라이브러리
ffmpeg : https://ffmpeg.org/  
FFmpeg.AutoGen : https://github.com/Ruslan-B/FFmpeg.AutoGen  
nQuant : https://archive.codeplex.com/?p=nquant

### 참고한 오픈소스 프로젝트
https://github.com/mrousavy/AnimatedGif

### 실행 환경
.NET Framework 4.7.2 이상

### Open Source
AnimateGif : https://github.com/mrousavy/AnimatedGif  
youtube-dl : https://github.com/ytdl-org/youtube-dl

### 담당 부분
해당 프로젝트는 짧은 시간의 GIF생성 프로그램을 제작하는 프로젝트이다. 프로젝트의 완성을 위해 요구되는 기능을 3개의 세부 모듈로 나누어 각 모듈의 완성을 보조 목표로 설정하였다. 첫째는 기존에 존재하는 동영상의 원하는 부분을 GIF로 변환하는 부분이고, 둘째는 유튜브 등의 이미 존재하는 플랫폼의 동영상을 동영상 파일로 다운로드 받을 수 있게 해주는 부분이며, 마지막은 사용자가 효율적으로 프로그램을 사용할 수 있게 해주는 GUI부분이다.  

본 프로젝트에서 맡은 부분은 두번째 모듈인 동영상플랫폼에서 동영상을 다운로드 받는 모듈제작과 GUI부분의 백앤드 부분을 담당하였다. 입력된 URL로 동영상을 다운로드 받기 위해 youtube-dl이라는 오픈 소스(http://github.com/ytdl-org/youtube-dl)를 사용하였다.  

## 1. youtube-dl을 해당 프로젝트에 적용하기 위해 해결해야 하는 문제점

### (1) youtube-dll은 URL과 옵션들의 조합으로 동영상을 다운로드를 받을 뿐 동영상의 파일명을 알아낼 수는 없다.
Youtube-dl은 파이썬으로 제작된 언어이고 youtube-dl또한 여러 개의 모듈로 나누어 동영상을 다운로드를 받는 방식이다. 여기서 원본 동영상을 다운로드 받는 모듈을 호출하는 직전에 파일입출력이라는 간단한 방법을 이용해 현재 다운로드 받는 파일의 파일명을 텍스트파일로 저장하는 방법을 사용하였다.  
다운로드 받는 과정 중 발생하는 상황은 총 3가지로 동영상을 정상적으로 다운로드를 받거나, 이미 존재하는 비디오파일인 경우, 예기치 못한 오류로 동영상을 다운로드 받지 못한 경우이다. 1,2번째의 경우는 파이썬 내부 코드의 수정으로 해결하였지만 3번째 경우는 실제 GUI연동과정 중 동영상의 제목을 가져오는 과정에서 C#내부 예외처리를 이용해 쉽게 해결하였다.

### (2) 특정한 디렉토리에 동영상파일이 존재하는지 검사해야 한다.
이는 앞서 이야기한 (1)과정 중 이미 존재하는 비디오파일인 경우에서 해당 함수를 호출하는 부분의 위치를 찾은 후 비디오파일의 경로를 탐색하는 위치 앞에 찾고자 하는 디렉터리의 경로를 추가해 비교적 간단하게 구현하였다.
비디오 파일의 위치는 파이썬의 os.path모듈을 이용하였다.

## 2. 제작한 모듈을 GUI와 연동 및 수정
완성한 GUI는 총 두가지의 화면으로 구성되어 있다.  
<b>
1.	URL을 입력 받아 동영상을 다운로드 받거나 이미 가지고 있는 동영상파일을 선택하는 화면  
![form1](https://user-images.githubusercontent.com/44914802/87289177-46356900-c537-11ea-8228-ca7c7d550c9b.png)
2.	선택된 비디오파일을 분석해 구간, fps 등과 같은 GIF파일 생성에 필요한 정보들을 받을 수 있는 화면  
![form3](https://user-images.githubusercontent.com/44914802/87289182-46cdff80-c537-11ea-858c-2fd4767e4997.png)
  </b>

### 1. URL을 입력 받아 동영상을 다운로드 받거나 이미 가지고 있는 동영상파일을 선택하는 화면
기능을 구현해야 할 부분은 OK버튼과 찾기 버튼에 대한 이벤트이다. OK버튼을 누를 때는 입력한 URL로 수정한 youtube-dl을 실행 해 실제 동영상 플랫폼에서 동영상을 다운로드를 받아야 하며 찾기 버튼을 눌렀을 때는 C#내부에 있는 OpenFileDialog를 이용해 mp4파일이나 webm파일을 선택하도록한다.
OK버튼을 눌렀을 때는 검사해야 할 비디오파일의 경로가 없거나 파일명을 담은 txt파일이 없을 경우를 대비해 Directory, File라이브러리를 이용해 미리 생성해 예외처리를 해주었고 Process 라이브러리를 통해 exe파일화 시킨youtube-dl을 실행 시킴으로 동영상을 다운로드를 받게 만들었다.
동영상을 다운로드 받았으면 동영상의 위치, 파일명을 다음화면으로 넘겨주고 현재화면을 안보이게 하였다.

### 2. 선택된 비디오파일을 분석해 구간, fps 등과 같은 GIF 파일 생성에 필요한 정보들을 받을 수 있는 화면
이 화면의 상태는 비디오파일이 존재하고 선택까지 되어 있는 상황이므로 GIF를 만들기 전 설정 해야 하는 정보(구간, FPS, 해상도)를 정해야 한다. 구간은 왼쪽아래에서 정할 수 있으며 재생버튼을 누르면 선택한 구간에 대한 동영상재생을 할 수 있도록 하였으며 실제 제작은 오른쪽 아래에 생성버튼으로 할 수 있게 구현하였다.
생성된 GIF가 저장될 위치 또한 정할 수 있는데 디폴트경로는 현재 실행중인 경로의 image 디렉토리 이며 찾기 버튼을 통해 저장위치를 변경할 수 있다.
